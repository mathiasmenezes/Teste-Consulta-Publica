{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useParams,useSearchParams}from'react-router-dom';import socialAuthService from'../../services/socialAuth';import{CheckCircle,AlertCircle}from'lucide-react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const OAuthCallback=()=>{const{provider}=useParams();const[searchParams]=useSearchParams();const[status,setStatus]=useState('processing');const[error,setError]=useState(null);useEffect(()=>{handleOAuthCallback();},[]);const handleOAuthCallback=async()=>{try{setStatus('processing');// Get parameters from URL\nconst accessToken=searchParams.get('access_token');const errorParam=searchParams.get('error');const errorDescription=searchParams.get('error_description');if(errorParam){throw new Error(errorDescription||'OAuth authentication failed');}if(!accessToken){throw new Error('No access token received');}let result;// Process the OAuth callback based on provider\nswitch(provider){case'google':result=await socialAuthService.handleGoogleCallback(accessToken);break;case'facebook':result=await socialAuthService.handleFacebookCallback(accessToken);break;default:throw new Error(\"Unsupported provider: \".concat(provider));}if(result.success){// Send success message to parent window\nwindow.opener.postMessage({type:'OAUTH_SUCCESS',payload:result},window.location.origin);setStatus('success');// Close popup after a short delay\nsetTimeout(()=>{window.close();},2000);}else{throw new Error('Authentication failed');}}catch(error){console.error('OAuth callback error:',error);setError(error.message);setStatus('error');// Send error message to parent window\nwindow.opener.postMessage({type:'OAUTH_ERROR',error:error.message},window.location.origin);// Close popup after a short delay\nsetTimeout(()=>{window.close();},3000);}};if(status==='processing'){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner mx-auto mb-4\"}),/*#__PURE__*/_jsxs(\"h2\",{className:\"text-xl font-semibold text-gray-900 mb-2\",children:[\"Completing \",provider,\" Login...\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Please wait while we complete your authentication.\"})]})});}if(status==='success'){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mx-auto h-16 w-16 bg-green-100 rounded-full flex items-center justify-center mb-4\",children:/*#__PURE__*/_jsx(CheckCircle,{className:\"h-8 w-8 text-green-600\"})}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-gray-900 mb-2\",children:\"Login Successful!\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600\",children:[\"You have been successfully authenticated with \",provider,\".\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500 mt-2\",children:\"This window will close automatically.\"})]})});}if(status==='error'){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mx-auto h-16 w-16 bg-red-100 rounded-full flex items-center justify-center mb-4\",children:/*#__PURE__*/_jsx(AlertCircle,{className:\"h-8 w-8 text-red-600\"})}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-gray-900 mb-2\",children:\"Login Failed\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-2\",children:error||'An error occurred during authentication.'}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"This window will close automatically.\"})]})});}return null;};export default OAuthCallback;","map":{"version":3,"names":["React","useEffect","useState","useParams","useSearchParams","socialAuthService","CheckCircle","AlertCircle","jsx","_jsx","jsxs","_jsxs","OAuthCallback","provider","searchParams","status","setStatus","error","setError","handleOAuthCallback","accessToken","get","errorParam","errorDescription","Error","result","handleGoogleCallback","handleFacebookCallback","concat","success","window","opener","postMessage","type","payload","location","origin","setTimeout","close","console","message","className","children"],"sources":["C:/Users/Highcastle/Documents/Cidadão+ Consulta Pública/src/components/auth/OAuthCallback.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useParams, useSearchParams } from 'react-router-dom';\r\nimport socialAuthService from '../../services/socialAuth';\r\nimport { CheckCircle, AlertCircle } from 'lucide-react';\r\n\r\nconst OAuthCallback = () => {\r\n  const { provider } = useParams();\r\n  const [searchParams] = useSearchParams();\r\n  const [status, setStatus] = useState('processing');\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    handleOAuthCallback();\r\n  }, []);\r\n\r\n  const handleOAuthCallback = async () => {\r\n    try {\r\n      setStatus('processing');\r\n\r\n      // Get parameters from URL\r\n      const accessToken = searchParams.get('access_token');\r\n      const errorParam = searchParams.get('error');\r\n      const errorDescription = searchParams.get('error_description');\r\n\r\n      if (errorParam) {\r\n        throw new Error(errorDescription || 'OAuth authentication failed');\r\n      }\r\n\r\n      if (!accessToken) {\r\n        throw new Error('No access token received');\r\n      }\r\n\r\n      let result;\r\n      \r\n      // Process the OAuth callback based on provider\r\n      switch (provider) {\r\n        case 'google':\r\n          result = await socialAuthService.handleGoogleCallback(accessToken);\r\n          break;\r\n        case 'facebook':\r\n          result = await socialAuthService.handleFacebookCallback(accessToken);\r\n          break;\r\n        default:\r\n          throw new Error(`Unsupported provider: ${provider}`);\r\n      }\r\n\r\n      if (result.success) {\r\n        // Send success message to parent window\r\n        window.opener.postMessage({\r\n          type: 'OAUTH_SUCCESS',\r\n          payload: result\r\n        }, window.location.origin);\r\n        \r\n        setStatus('success');\r\n        \r\n        // Close popup after a short delay\r\n        setTimeout(() => {\r\n          window.close();\r\n        }, 2000);\r\n      } else {\r\n        throw new Error('Authentication failed');\r\n      }\r\n    } catch (error) {\r\n      console.error('OAuth callback error:', error);\r\n      setError(error.message);\r\n      setStatus('error');\r\n      \r\n      // Send error message to parent window\r\n      window.opener.postMessage({\r\n        type: 'OAUTH_ERROR',\r\n        error: error.message\r\n      }, window.location.origin);\r\n      \r\n      // Close popup after a short delay\r\n      setTimeout(() => {\r\n        window.close();\r\n      }, 3000);\r\n    }\r\n  };\r\n\r\n  if (status === 'processing') {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100\">\r\n        <div className=\"text-center\">\r\n          <div className=\"loading-spinner mx-auto mb-4\"></div>\r\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">\r\n            Completing {provider} Login...\r\n          </h2>\r\n          <p className=\"text-gray-600\">\r\n            Please wait while we complete your authentication.\r\n          </p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (status === 'success') {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100\">\r\n        <div className=\"text-center\">\r\n          <div className=\"mx-auto h-16 w-16 bg-green-100 rounded-full flex items-center justify-center mb-4\">\r\n            <CheckCircle className=\"h-8 w-8 text-green-600\" />\r\n          </div>\r\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">\r\n            Login Successful!\r\n          </h2>\r\n          <p className=\"text-gray-600\">\r\n            You have been successfully authenticated with {provider}.\r\n          </p>\r\n          <p className=\"text-sm text-gray-500 mt-2\">\r\n            This window will close automatically.\r\n          </p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (status === 'error') {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100\">\r\n        <div className=\"text-center\">\r\n          <div className=\"mx-auto h-16 w-16 bg-red-100 rounded-full flex items-center justify-center mb-4\">\r\n            <AlertCircle className=\"h-8 w-8 text-red-600\" />\r\n          </div>\r\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">\r\n            Login Failed\r\n          </h2>\r\n          <p className=\"text-gray-600 mb-2\">\r\n            {error || 'An error occurred during authentication.'}\r\n          </p>\r\n          <p className=\"text-sm text-gray-500\">\r\n            This window will close automatically.\r\n          </p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nexport default OAuthCallback;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}